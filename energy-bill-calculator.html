<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Bill Calculator | SwitchPilot</title>
    <meta name="description" content="Find out if you're overpaying for energy in 2 minutes. Free calculator shows your exact costs and compares tariffs - most people save ¬£200+/year.">
    <link rel="canonical" href="https://www.switch-pilot.com/energy-bill-calculator.html">

    <!-- Open Graph (Facebook, LinkedIn, WhatsApp) -->
    <meta property="og:title" content="Energy Bill Calculator | SwitchPilot">
    <meta property="og:description" content="Calculate your energy bill based on your actual usage. Enter your postcode, select your home size, fine-tune by appliance, and compare tariffs to find the best deal.">
    <meta property="og:url" content="https://www.switch-pilot.com/energy-bill-calculator.html">
    <meta property="og:type" content="website">
    <meta property="og:image" content="https://mitran101.github.io/smart-switch/logo.png">
    <meta property="og:site_name" content="SwitchPilot">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Energy Bill Calculator | SwitchPilot">
    <meta name="twitter:description" content="Calculate your energy bill based on your actual usage. Enter your postcode, select your home size, fine-tune by appliance, and compare tariffs to find the best deal.">
    <meta name="twitter:image" content="https://mitran101.github.io/smart-switch/logo.png">

    <!-- Favicons -->
    <link rel="icon" href="./favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WEQ6VBT567"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-WEQ6VBT567');
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --sp-slate: #1E293B;
            --sp-slate-light: #94A3B8;
            --sp-purple: #8b5cf6;
            --sp-purple-dark: #7c3aed;
            --sp-purple-light: #ede9fe;
            --sp-green: #10b981;
            --sp-green-dark: #059669;
            --sp-pink: #EC4899;
            --sp-red: #ef4444;
            --sp-amber: #F59E0B;
            --sp-bg: #f8fafc;
            --sp-card: #ffffff;
            --sp-border: rgba(148, 163, 184, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--sp-bg);
            color: var(--sp-slate);
            line-height: 1.6;
        }

        /* Top Navigation - Matching Tracker */
        .top-nav {
            background: var(--sp-slate);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-weight: 700;
            color: white;
        }

        .top-logo img { height: 3.2rem; width: auto; margin-right: -15px; }
        .top-logo span { font-size: 1.35rem; }

        .back-home {
            padding: 10px 20px;
            background: rgba(255,255,255,0.1);
            color: white;
            text-decoration: none;
            border-radius: 30px;
            font-weight: 600;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .back-home:hover { background: rgba(255,255,255,0.2); }

        /* Hero Header - Matching Tracker */
        .header {
            background: linear-gradient(135deg, var(--sp-purple) 0%, var(--sp-pink) 100%);
            color: white;
            padding: 4rem 2rem 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0; right: 0;
            width: 50%; height: 100%;
            background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23FFFFFF' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            opacity: 0.5;
        }

        .header-content { max-width: 800px; margin: 0 auto; position: relative; z-index: 1; }

        .header h1 {
            font-family: 'DM Serif Display', Georgia, serif;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 400;
            margin-bottom: 0.75rem;
        }

        .header p { color: rgba(255,255,255,0.9); font-size: 1.1rem; }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 1100px) {
            .main-container { grid-template-columns: 1fr; }
        }

        .card {
            background: var(--sp-card);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.06);
            border: 1px solid var(--sp-border);
        }

        .card h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .region-bar {
            background: var(--sp-card);
            padding: 20px 30px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .region-bar label { font-weight: 600; }

        .region-bar select {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            background: white;
            min-width: 200px;
            cursor: pointer;
        }

        .region-bar select:focus {
            outline: none;
            border-color: var(--sp-purple);
        }

        .loading-state {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top-color: var(--sp-purple);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .supplier-selector select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            background: white;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .supplier-selector select:focus {
            outline: none;
            border-color: var(--sp-purple);
            box-shadow: 0 0 0 3px var(--sp-purple-light);
        }

        .current-rates {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .rate-box {
            background: var(--sp-bg);
            padding: 14px;
            border-radius: 10px;
            text-align: center;
        }

        .rate-box .label {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 4px;
        }

        .rate-box .value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--sp-purple);
        }

        .rate-box .value span {
            font-size: 0.85rem;
            font-weight: 500;
        }

        .bill-summary {
            background: linear-gradient(135deg, var(--sp-purple) 0%, var(--sp-purple-dark) 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
        }

        .period-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .period-tab {
            padding: 8px 14px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            transition: background 0.2s;
            font-family: inherit;
        }

        .period-tab.active {
            background: white;
            color: var(--sp-purple);
        }

        .bill-amount {
            font-size: 3.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 5px;
        }

        .bill-amount span { font-size: 1.5rem; }

        .bill-breakdown {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .comparison-banner {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
        }

        .comparison-item {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
        }

        .comparison-item.current { background: var(--sp-purple-light); }
        .comparison-item.svt { background: #fef2f2; }

        .comparison-item .label {
            font-size: 0.8rem;
            color: #64748b;
            margin-bottom: 5px;
        }

        .comparison-item .amount {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .comparison-item.current .amount { color: var(--sp-purple); }
        .comparison-item.svt .amount { color: var(--sp-red); }

        .comparison-vs { font-weight: 700; color: #94a3b8; }

        .savings-badge {
            background: var(--sp-green);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 700;
            text-align: center;
            font-size: 1.1rem;
        }

        .chart-container {
            position: relative;
            height: 320px;
            margin-bottom: 15px;
        }

        .chart-hint {
            text-align: center;
            font-size: 0.85rem;
            color: #64748b;
        }

        .appliances-grid {
            display: grid;
            gap: 12px;
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .appliance {
            background: var(--sp-bg);
            padding: 14px;
            border-radius: 10px;
            border: 1px solid #e8e8ed;
        }

        .appliance-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .appliance-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .appliance-cost {
            font-weight: 700;
            color: var(--sp-purple);
            font-size: 1rem;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
            margin: 8px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--sp-purple);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(139, 92, 246, 0.4);
        }

        .appliance-usage {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #64748b;
        }

        .fuel-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .fuel-tab {
            flex: 1;
            padding: 12px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
            font-family: inherit;
        }

        .fuel-tab.active {
            border-color: var(--sp-purple);
            background: var(--sp-purple-light);
            color: var(--sp-purple);
        }

        /* Home size presets */
        .preset-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .preset-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            background: white;
            color: var(--sp-slate);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            font-weight: 600;
            font-family: inherit;
        }

        .preset-btn:hover {
            border-color: var(--sp-purple);
            background: var(--sp-purple-light);
        }

        .preset-btn.active {
            border-color: var(--sp-purple);
            background: var(--sp-purple);
            color: white;
        }

        .fuel-type-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            background: white;
            border: 2px solid #E2E8F0;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--sp-slate);
            cursor: pointer;
            transition: all 0.2s;
        }

        .fuel-type-btn:hover {
            border-color: var(--sp-green);
        }

        .fuel-type-btn.active {
            background: var(--sp-green);
            border-color: var(--sp-green);
            color: white;
        }

        /* CTA Section - Matching Tracker */
        .cta-section {
            background: linear-gradient(135deg, var(--sp-purple) 0%, var(--sp-pink) 100%);
            border-radius: 16px;
            padding: 2rem;
            display: flex;
            align-items: center;
            gap: 1.5rem;
            color: white;
            grid-column: 1 / -1;
            flex-wrap: wrap;
        }

        .cta-section .icon { font-size: 2.5rem; }

        .cta-section .content { flex: 1; min-width: 250px; }

        .cta-section h3 {
            font-family: 'DM Serif Display', Georgia, serif;
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 0.5rem;
        }

        .cta-section p {
            color: rgba(255,255,255,0.9);
            margin: 0;
        }

        .cta-btn {
            display: inline-block;
            padding: 14px 35px;
            background: white;
            color: var(--sp-purple);
            text-decoration: none;
            border-radius: 30px;
            font-weight: 700;
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap;
        }

        .cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        /* Footer - Matching Tracker */
        .footer {
            background: var(--sp-slate);
            border-top: 1px solid var(--sp-border);
            color: var(--sp-slate-light);
            text-align: center;
            padding: 3rem 2rem;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .footer-logo img { height: 2.5rem; width: auto; margin-right: -10px; }
        .footer-logo span { font-size: 1.25rem; font-weight: 700; color: white; }

        .footer p { color: #94a3b8; font-size: 0.9rem; margin: 0.5rem 0; }
        .footer a { color: var(--sp-purple); text-decoration: none; }

        .appliances-grid::-webkit-scrollbar { width: 6px; }
        .appliances-grid::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        .appliances-grid::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }

        /* Responsive */
        @media (max-width: 768px) {
            .top-nav { padding: 1rem; }
            .top-logo img { height: 2.5rem; }
            .top-logo span { font-size: 1.25rem; }
            .back-home { padding: 0.5rem 1rem; font-size: 0.8rem; }

            .header { padding: 3rem 1.5rem 2.5rem; }

            .cta-section { flex-direction: column; text-align: center; padding: 1.5rem; }
            .cta-section .content { text-align: center; }
            
            .preset-buttons { flex-direction: column; }
        }

        @media (max-width: 480px) {
            .header { padding: 2.5rem 1rem 2rem; }
            .header h1 { font-size: 1.75rem; }
            .main-container { padding: 20px 15px; }
        }
    </style>
</head>
<body>
    <nav class="top-nav">
        <a href="index.html" class="top-logo">
            <img src="https://mitran101.github.io/smart-switch/logo.png" alt="">
            <span>SwitchPilot</span>
        </a>
        <a href="index.html" class="back-home">‚Üê Back to Home</a>
    </nav>

    <header class="header">
        <div class="header-content">
            <h1>‚ö° Energy Bill Calculator</h1>
            <p>See exactly how your usage adds up and compare tariffs in real-time</p>
        </div>
    </header>

    <div class="region-bar">
        <div class="input-group" style="margin-bottom: 1rem;">
            <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--sp-slate);">Energy Type</label>
            <div style="display: flex; gap: 0.5rem;">
                <button class="fuel-type-btn active" onclick="setFuelType('dual')" id="dualFuelBtn">
                    ‚ö°üî• Dual Fuel
                </button>
                <button class="fuel-type-btn" onclick="setFuelType('elec')" id="elecOnlyBtn">
                    ‚ö° Electricity Only
                </button>
            </div>
        </div>
        <label for="postcodeInput">üìç Your Postcode:</label>
        <input type="text" id="postcodeInput" placeholder="e.g. SW1A 1AA" maxlength="8" style="
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            background: white;
            width: 150px;
            text-transform: uppercase;
            transition: border-color 0.2s, box-shadow 0.2s;
        " onfocus="this.style.borderColor='#8b5cf6'; this.style.boxShadow='0 0 0 3px #ede9fe';" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='none';">
    </div>

    <div class="main-container">
        <div class="card">
            <h2>üìä Tariff Comparison</h2>
            
            <div id="loadingState" class="loading-state">
                <div class="spinner"></div>
                <p>Loading tariff data...</p>
            </div>

            <div id="tariffContent" style="display: none;">
                <div class="supplier-selector">
                    <select id="supplierSelect" onchange="changeSupplier()">
                        <option value="svt">‚ö†Ô∏è SVT Price Cap (most expensive default rate)</option>
                    </select>
                </div>

                <div class="current-rates" id="currentRatesGrid">
                    <div class="rate-box">
                        <div class="label">‚ö° Electricity unit rate</div>
                        <div class="value" id="elecRateDisplay">--<span>p/kWh</span></div>
                    </div>
                    <div class="rate-box" id="gasRateBox">
                        <div class="label">üî• Gas unit rate</div>
                        <div class="value" id="gasRateDisplay">--<span>p/kWh</span></div>
                    </div>
                    <div class="rate-box">
                        <div class="label">‚ö° Electricity standing charge</div>
                        <div class="value" id="elecStandingDisplay">--<span>p/day</span></div>
                    </div>
                    <div class="rate-box" id="gasStandingBox">
                        <div class="label">üî• Gas standing charge</div>
                        <div class="value" id="gasStandingDisplay">--<span>p/day</span></div>
                    </div>
                </div>

                <p style="text-align: center; margin-top: 1.25rem; font-size: 0.9rem; color: var(--sp-slate-light);">
                    üí° <a href="tariff-tracker.html" style="color: var(--sp-green-dark); font-weight: 600; text-decoration: none;">Check our tariff tracker</a> to see the best available tariffs across all suppliers
                </p>

                <p style="text-align: center; margin-top: 0.5rem; margin-bottom: 1.25rem; font-size: 0.8rem; color: var(--sp-slate-light); opacity: 0.8;">
                    üì± May require smart meter ‚Ä¢ üöó May require EV ‚Ä¢ Check supplier website for eligibility
                </p>

                <div class="bill-summary">
                    <div class="period-tabs">
                        <button class="period-tab" onclick="setPeriod('day')">Daily</button>
                        <button class="period-tab" onclick="setPeriod('week')">Weekly</button>
                        <button class="period-tab active" onclick="setPeriod('month')">Monthly</button>
                        <button class="period-tab" onclick="setPeriod('year')">Annual</button>
                    </div>
                    <div class="bill-amount" id="totalBill">--<span>/mo</span></div>
                    <div class="bill-breakdown" id="billBreakdown">--</div>
                </div>

                <div class="comparison-banner">
                    <div class="comparison-item current">
                        <div class="label">Selected Tariff</div>
                        <div class="amount" id="currentTariffCost">--/yr</div>
                    </div>
                    <div class="comparison-vs">vs</div>
                    <div class="comparison-item svt">
                        <div class="label">SVT Price Cap</div>
                        <div class="amount" id="svtCost">--/yr</div>
                    </div>
                </div>
                <div class="savings-badge" id="savingsBadge">Select a supplier to see savings</div>

                <h2 style="margin-top: 25px;">üí∞ Best Deals in <span id="regionDisplay">London</span></h2>
                <div class="chart-container">
                    <canvas id="tariffChart"></canvas>
                </div>
                <p class="chart-hint">üëÜ Click a bar to select that supplier</p>
            </div>
        </div>

        <div class="card">
            <h2>üîå Your Usage</h2>
            
            <p style="color: #64748b; font-size: 0.9rem; margin-bottom: 15px;">Select your home size to estimate usage, or enter your actual kWh from a bill.</p>
            
            <!-- Home Size Selection -->
            <div class="preset-buttons">
                <button class="preset-btn" onclick="setPreset('small')">üè¢ Small<br><span style="font-weight: 400; font-size: 0.8rem;">1-2 bed</span></button>
                <button class="preset-btn active" onclick="setPreset('medium')">üè† Medium<br><span style="font-weight: 400; font-size: 0.8rem;">3 bed</span></button>
                <button class="preset-btn" onclick="setPreset('large')">üè° Large<br><span style="font-weight: 400; font-size: 0.8rem;">4+ bed</span></button>
            </div>
            
            <!-- Editable Usage Estimates -->
            <div style="background: var(--sp-purple-light); border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                <div id="usageInputsGrid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 6px; color: var(--sp-purple-dark);">‚ö° Electricity (kWh/year)</label>
                        <input type="number" id="elecKwhInput" value="2900" min="0" max="20000" step="100"
                               oninput="updateFromKwh()"
                               style="width: 100%; padding: 12px; border: 2px solid #ddd6fe; border-radius: 8px; font-size: 1.1rem; font-weight: 600; font-family: inherit; text-align: center;">
                    </div>
                    <div id="gasInputSection">
                        <label style="display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 6px; color: var(--sp-purple-dark);">üî• Gas (kWh/year)</label>
                        <input type="number" id="gasKwhInput" value="12000" min="0" max="50000" step="100"
                               oninput="updateFromKwh()"
                               style="width: 100%; padding: 12px; border: 2px solid #ddd6fe; border-radius: 8px; font-size: 1.1rem; font-weight: 600; font-family: inherit; text-align: center;">
                    </div>
                </div>
                <p style="margin-top: 12px; font-size: 0.8rem; color: #64748b; text-align: center;">üí° Find your actual usage on a recent energy bill</p>
            </div>
            
            <!-- Appliances Breakdown -->
            <div style="border-top: 1px solid #e2e8f0; padding-top: 20px; margin-top: 5px;">
                <p style="font-weight: 600; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">üîß Fine-tune by appliance</p>
                
                <div class="fuel-tabs">
                    <button class="fuel-tab active" id="elecTab" onclick="showFuel('elec')">‚ö° Electricity</button>
                    <button class="fuel-tab" id="gasTab" onclick="showFuel('gas')">üî• Gas</button>
                </div>

                <div id="elecAppliances" class="appliances-grid"></div>
                <div id="gasAppliances" class="appliances-grid" style="display: none;"></div>
            </div>
        </div>

        <div class="cta-section">
            <div class="icon">üò©</div>
            <div class="content">
                <h3>Tired of comparing tariffs every few months?</h3>
                <p>We're building a free auto-switcher that does this for you ‚Äî automatically. Sign up for early access and never overpay again.</p>
            </div>
            <a href="index.html#waitlist" class="cta-btn">Get Early Access ‚Üí</a>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-logo">
            <img src="https://mitran101.github.io/smart-switch/logo.png" alt="">
            <span>SwitchPilot</span>
        </div>
        <p>Putting the power back in your hands</p>
        <p style="margin-top: 1rem;">üìß Questions? <a href="mailto:crew@switch-pilot.com">crew@switch-pilot.com</a></p>
    </footer>

    <script>
        // Ofgem Price Cap rates by region (Jan-Mar 2026, Direct Debit, inc VAT)
        const capRatesByRegion = {
            'London': { elecUnit: 27.00, elecStanding: 47.11, gasUnit: 6.03, gasStanding: 35.63 },
            'South East': { elecUnit: 28.27, elecStanding: 48.66, gasUnit: 5.83, gasStanding: 34.68 },
            'Southern': { elecUnit: 27.83, elecStanding: 45.70, gasUnit: 6.00, gasStanding: 34.56 },
            'South West': { elecUnit: 28.16, elecStanding: 55.11, gasUnit: 6.15, gasStanding: 34.71 },
            'South Wales': { elecUnit: 28.18, elecStanding: 52.75, gasUnit: 6.11, gasStanding: 35.35 },
            'Eastern': { elecUnit: 27.88, elecStanding: 49.33, gasUnit: 5.87, gasStanding: 34.74 },
            'East Midlands': { elecUnit: 26.89, elecStanding: 50.17, gasUnit: 5.79, gasStanding: 34.82 },
            'West Midlands': { elecUnit: 26.99, elecStanding: 54.08, gasUnit: 5.85, gasStanding: 35.12 },
            'North West': { elecUnit: 28.45, elecStanding: 52.22, gasUnit: 5.89, gasStanding: 35.23 },
            'North East': { elecUnit: 26.75, elecStanding: 60.93, gasUnit: 5.93, gasStanding: 35.21 },
            'Yorkshire': { elecUnit: 26.69, elecStanding: 59.72, gasUnit: 5.90, gasStanding: 35.18 },
            'North Wales & Merseyside': { elecUnit: 29.09, elecStanding: 71.01, gasUnit: 5.94, gasStanding: 35.49 },
            'South Scotland': { elecUnit: 27.18, elecStanding: 57.62, gasUnit: 5.89, gasStanding: 35.30 },
            'North Scotland': { elecUnit: 28.36, elecStanding: 62.07, gasUnit: 5.89, gasStanding: 35.28 }
        };
        
        // Helper to get current region's SVT rates
        function getSVT() {
            const rates = capRatesByRegion[currentRegion] || capRatesByRegion['London'];
            return {
                elec_unit_rate_p: rates.elecUnit,
                elec_standing_p: rates.elecStanding,
                gas_unit_rate_p: rates.gasUnit,
                gas_standing_p: rates.gasStanding
            };
        }

        const supplierColors = {
            'fuse_energy': '#ffb366',
            'edf': '#ff8c00',
            'eon_next': '#e4002b',
            'scottish_power': '#7dd87d',
            'ovo': '#00dc64',
            'british_gas': '#0066cc',
            'octopus': '#a855f7',
            'so_energy': '#C8F000',
            'svt': '#ef4444'
        };

        // Dynamic supplier names - populated from JSON data
        const supplierNames = {};

        // Home size presets - annual kWh estimates
        const homePresets = {
            small: { elec: 1800, gas: 8000 },
            medium: { elec: 2900, gas: 12000 },
            large: { elec: 4200, gas: 17000 }
        };

        // Appliance defaults per home size (for the fine-tune section)
        const applianceDefaults = {
            small: {
                fridge: 24, lights: 4, tv: 3, computer: 4, washing: 2, dishwasher: 2, kettle: 3, microwave: 1, eshower: 0, eheating: 0, evcharger: 0,
                hob: 0.3, oven: 0.3, gshower: 10, heating: 2, hotwater: 0
            },
            medium: {
                fridge: 24, lights: 6, tv: 4, computer: 6, washing: 4, dishwasher: 3, kettle: 4, microwave: 2, eshower: 0, eheating: 0, evcharger: 0,
                hob: 0.5, oven: 0.5, gshower: 15, heating: 4, hotwater: 0
            },
            large: {
                fridge: 24, lights: 10, tv: 6, computer: 8, washing: 7, dishwasher: 5, kettle: 6, microwave: 3, eshower: 0, eheating: 0, evcharger: 0,
                hob: 1, oven: 1, gshower: 25, heating: 6, hotwater: 0
            }
        };

        const elecAppliances = [
            { name: 'Fridge/Freezer', power: 0.15, unit: 'hours/day', max: 24, default: 24, id: 'fridge' },
            { name: 'LED Lights', power: 0.06, unit: 'hours/day', max: 24, default: 6, id: 'lights' },
            { name: 'TV', power: 0.1, unit: 'hours/day', max: 24, default: 4, id: 'tv' },
            { name: 'Laptop/Computer', power: 0.075, unit: 'hours/day', max: 24, default: 6, id: 'computer' },
            { name: 'Washing Machine', power: 1.5, unit: 'loads/week', max: 14, default: 4, id: 'washing' },
            { name: 'Dishwasher', power: 1.2, unit: 'loads/week', max: 14, default: 3, id: 'dishwasher' },
            { name: 'Kettle', power: 0.15, unit: 'boils/day', max: 20, default: 4, id: 'kettle' },
            { name: 'Microwave', power: 0.8, unit: 'uses/day', max: 10, default: 2, id: 'microwave' },
            { name: 'Electric Shower', power: 1.5, unit: 'mins/day', max: 60, default: 0, id: 'eshower' },
            { name: 'Electric Heating', power: 2.0, unit: 'hours/day', max: 24, default: 0, id: 'eheating' },
            { name: 'EV Charger', power: 7.0, unit: 'hours/week', max: 50, default: 0, id: 'evcharger' }
        ];

        const gasAppliances = [
            { name: 'Gas Hob', power: 2.0, unit: 'hours/day', max: 4, default: 0.5, id: 'hob' },
            { name: 'Gas Oven', power: 2.5, unit: 'hours/day', max: 4, default: 0.5, id: 'oven' },
            { name: 'Gas Shower (Combi)', power: 10.0, unit: 'mins/day', max: 60, default: 15, id: 'gshower' },
            { name: 'Central Heating (Winter)', power: 15.0, unit: 'hours/day', max: 24, default: 4, id: 'heating' },
            { name: 'Hot Water (Non-Combi)', power: 3.0, unit: 'hours/day', max: 8, default: 0, id: 'hotwater' }
        ];

        // Postcode to region mapping
        const postcodeRegions = {
            'AB': 'North Scotland', 'IV': 'North Scotland', 'KW': 'North Scotland', 'PH': 'North Scotland', 'DD': 'North Scotland', 'FK': 'North Scotland',
            'G': 'South Scotland', 'PA': 'South Scotland', 'KA': 'South Scotland', 'ML': 'South Scotland', 'EH': 'South Scotland', 'KY': 'South Scotland', 'TD': 'South Scotland', 'DG': 'South Scotland',
            'NE': 'North East', 'DH': 'North East', 'SR': 'North East', 'TS': 'North East', 'DL': 'North East',
            'YO': 'Yorkshire', 'HU': 'Yorkshire', 'DN': 'Yorkshire', 'S': 'Yorkshire', 'HD': 'Yorkshire', 'HX': 'Yorkshire', 'WF': 'Yorkshire', 'LS': 'Yorkshire', 'BD': 'Yorkshire', 'HG': 'Yorkshire',
            'M': 'North West', 'OL': 'North West', 'BL': 'North West', 'SK': 'North West', 'WN': 'North West', 'PR': 'North West', 'BB': 'North West', 'FY': 'North West', 'LA': 'North West', 'CA': 'North West', 'CW': 'North West',
            'L': 'North Wales & Merseyside', 'CH': 'North Wales & Merseyside', 'LL': 'North Wales & Merseyside', 'WA': 'North Wales & Merseyside',
            'CF': 'South Wales', 'NP': 'South Wales', 'SA': 'South Wales',
            'B': 'West Midlands', 'CV': 'West Midlands', 'DY': 'West Midlands', 'WS': 'West Midlands', 'WV': 'West Midlands', 'ST': 'West Midlands', 'TF': 'West Midlands', 'SY': 'West Midlands', 'WR': 'West Midlands', 'HR': 'West Midlands',
            'DE': 'East Midlands', 'NG': 'East Midlands', 'LE': 'East Midlands', 'LN': 'East Midlands', 'PE': 'East Midlands', 'NN': 'East Midlands',
            'IP': 'Eastern', 'NR': 'Eastern', 'CB': 'Eastern', 'CO': 'Eastern', 'CM': 'Eastern', 'SG': 'Eastern', 'AL': 'Eastern', 'EN': 'Eastern', 'SS': 'Eastern', 'RM': 'Eastern',
            'E': 'London', 'EC': 'London', 'N': 'London', 'NW': 'London', 'SE': 'London', 'SW': 'London', 'W': 'London', 'WC': 'London',
            'BN': 'South East', 'RH': 'South East', 'TN': 'South East', 'CT': 'South East', 'ME': 'South East', 'DA': 'South East', 'BR': 'South East', 'CR': 'South East', 'KT': 'South East', 'SM': 'South East', 'SL': 'South East', 'HP': 'South East', 'MK': 'South East', 'LU': 'South East', 'OX': 'South East', 'RG': 'South East', 'GU': 'South East',
            'BH': 'Southern', 'SO': 'Southern', 'PO': 'Southern', 'SP': 'Southern',
            'PL': 'South West', 'TR': 'South West', 'EX': 'South West', 'TQ': 'South West', 'DT': 'South West', 'BA': 'South West', 'TA': 'South West', 'BS': 'South West', 'GL': 'South West', 'SN': 'South West'
        };

        function detectRegion(postcode) {
            const cleaned = postcode.replace(/\s/g, '').toUpperCase();
            for (let len = 3; len >= 1; len--) {
                const prefix = cleaned.substring(0, len);
                if (postcodeRegions[prefix]) return postcodeRegions[prefix];
            }
            return null;
        }

        let allTariffs = [];
        let regionalTariffs = [];
        let currentRegion = 'London';
        let currentTariff = null;
        let currentPeriod = 'month';
        let periodMultiplier = 30;
        let tariffChart = null;
        let currentPreset = 'medium';
        let currentFuelType = 'dual'; // 'dual' or 'elec'

        document.addEventListener('DOMContentLoaded', () => {
            createAppliances();
            loadTariffData();
            
            // Postcode input listener
            document.getElementById('postcodeInput').addEventListener('input', function() {
                const postcode = this.value;
                const hint = document.getElementById('regionHint');
                const region = detectRegion(postcode);
                
                if (region) {
                    currentRegion = region;
                    hint.textContent = '‚úì ' + region;
                    hint.style.color = '#10b981';
                    
                    // Re-filter tariffs for new region
                    if (allTariffs.length > 0) {
                        changeRegion();
                    }
                } else if (postcode.length >= 2) {
                    hint.textContent = '‚ö† Region not found';
                    hint.style.color = '#ef4444';
                } else {
                    hint.textContent = 'Enter postcode to detect region';
                    hint.style.color = '#64748b';
                }
            });
        });

        function setPreset(size) {
            currentPreset = size;
            const preset = homePresets[size];
            const appDefaults = applianceDefaults[size];
            
            // Update kWh inputs
            document.getElementById('elecKwhInput').value = preset.elec;
            document.getElementById('gasKwhInput').value = preset.gas;
            
            // Update appliance sliders too
            [...elecAppliances, ...gasAppliances].forEach(app => {
                const slider = document.getElementById(app.id);
                const valueDisplay = document.getElementById(`${app.id}-value`);
                if (slider && appDefaults[app.id] !== undefined) {
                    slider.value = appDefaults[app.id];
                    valueDisplay.textContent = parseFloat(appDefaults[app.id]).toFixed(1);
                }
            });
            
            // Update button states
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.preset-btn').classList.add('active');
            
            calculateAll();
        }
        
        function updateFromKwh() {
            // When user manually edits kWh, recalculate bill
            calculateAll();
        }

        async function loadTariffData() {
            try {
                const response = await fetch('./all_tariffs.json');
                const data = await response.json();

                // Dynamically detect suppliers with BOTH electricity AND gas data
                const rawTariffs = data.tariffs || data;

                // First pass: build supplier names mapping
                rawTariffs.forEach(t => {
                    // Check if tariff has required data based on fuel type
                    let hasRequiredData;
                    if (currentFuelType === 'dual') {
                        // Dual fuel: need both elec and gas
                        hasRequiredData = !t.error &&
                            t.elec_unit_rate_p !== null && t.elec_unit_rate_p !== undefined &&
                            t.gas_unit_rate_p !== null && t.gas_unit_rate_p !== undefined;
                    } else {
                        // Electricity only: just need elec
                        hasRequiredData = !t.error &&
                            t.elec_unit_rate_p !== null && t.elec_unit_rate_p !== undefined;
                    }

                    if (hasRequiredData) {
                        // Normalize supplier name (handle "So Energy" -> "so_energy")
                        const normalizedSupplier = t.supplier.toLowerCase().replace(/\s+/g, '_');

                        // Store display name if not already present
                        if (!supplierNames[normalizedSupplier]) {
                            // Handle special cases for proper branding
                            let displayName;
                            if (normalizedSupplier === 'so_energy') {
                                displayName = 'SO Energy';
                            } else if (normalizedSupplier === 'ovo') {
                                displayName = 'OVO Energy';
                            } else if (normalizedSupplier === 'octopus') {
                                displayName = 'Octopus Energy';
                            } else {
                                // Default: capitalize first letter of each word
                                displayName = t.supplier.split(/[\s_]+/).map(word =>
                                    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
                                ).join(' ');
                            }
                            supplierNames[normalizedSupplier] = displayName;
                        }
                    }
                });

                // Second pass: filter tariffs using normalized supplier names
                allTariffs = rawTariffs.filter(t => {
                    if (t.error || t.elec_unit_rate_p === null || t.elec_unit_rate_p === undefined) {
                        return false;
                    }

                    // For dual fuel, also check gas data
                    if (currentFuelType === 'dual') {
                        if (t.gas_unit_rate_p === null || t.gas_unit_rate_p === undefined) {
                            return false;
                        }
                    }

                    const normalizedSupplier = t.supplier.toLowerCase().replace(/\s+/g, '_');
                    return supplierNames[normalizedSupplier] !== undefined;
                }).map(t => {
                    // Normalize the supplier field in the tariff object
                    return {
                        ...t,
                        supplier: t.supplier.toLowerCase().replace(/\s+/g, '_')
                    };
                });

                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('tariffContent').style.display = 'block';

                // Set default region and load
                currentRegion = 'London';
                changeRegion();
            } catch (e) {
                console.error('Failed to load tariff data:', e);
                document.getElementById('loadingState').innerHTML = `
                    <p style="color: var(--sp-red);">Failed to load tariff data. Please refresh.</p>
                `;
            }
        }

        function setFuelType(type) {
            currentFuelType = type;

            // Update button states
            document.getElementById('dualFuelBtn').classList.toggle('active', type === 'dual');
            document.getElementById('elecOnlyBtn').classList.toggle('active', type === 'elec');

            // Hide/show gas-related elements
            const gasTab = document.getElementById('gasTab');
            const gasInputSection = document.getElementById('gasInputSection');
            const gasRateBox = document.getElementById('gasRateBox');
            const gasStandingBox = document.getElementById('gasStandingBox');
            const usageInputsGrid = document.getElementById('usageInputsGrid');
            const currentRatesGrid = document.getElementById('currentRatesGrid');

            if (gasTab) {
                gasTab.style.display = type === 'dual' ? 'inline-block' : 'none';
            }
            if (gasInputSection) {
                gasInputSection.style.display = type === 'dual' ? 'block' : 'none';
            }
            if (gasRateBox) {
                gasRateBox.style.display = type === 'dual' ? 'block' : 'none';
            }
            if (gasStandingBox) {
                gasStandingBox.style.display = type === 'dual' ? 'block' : 'none';
            }
            if (usageInputsGrid) {
                usageInputsGrid.style.gridTemplateColumns = type === 'dual' ? '1fr 1fr' : '1fr';
            }
            if (currentRatesGrid) {
                currentRatesGrid.style.gridTemplateColumns = type === 'dual' ? 'repeat(2, 1fr)' : 'repeat(1, 1fr)';
            }

            // If switching to elec-only and gas tab is active, switch to elec tab
            if (type === 'elec' && gasTab && gasTab.classList.contains('active')) {
                showFuel('elec');
            }

            // Reload tariffs with new filter
            loadTariffData();
        }

        function createAppliances() {
            const elecContainer = document.getElementById('elecAppliances');
            const gasContainer = document.getElementById('gasAppliances');

            elecAppliances.forEach(app => {
                elecContainer.innerHTML += createApplianceHTML(app);
            });

            gasAppliances.forEach(app => {
                gasContainer.innerHTML += createApplianceHTML(app);
            });
        }

        function createApplianceHTML(app) {
            return `
                <div class="appliance">
                    <div class="appliance-header">
                        <span class="appliance-name">${app.name}</span>
                        <span class="appliance-cost" id="${app.id}-cost">¬£0.00</span>
                    </div>
                    <input type="range" id="${app.id}" min="0" max="${app.max}" value="${app.default}" step="0.5" 
                           oninput="updateAppliance('${app.id}')">
                    <div class="appliance-usage">
                        <span><span id="${app.id}-value">${app.default}</span> ${app.unit}</span>
                        <span>${app.power} kWh/${app.unit.split('/')[0]}</span>
                    </div>
                </div>
            `;
        }

        function showFuel(fuel) {
            document.getElementById('elecAppliances').style.display = fuel === 'elec' ? 'grid' : 'none';
            document.getElementById('gasAppliances').style.display = fuel === 'gas' ? 'grid' : 'none';
            document.getElementById('elecTab').classList.toggle('active', fuel === 'elec');
            document.getElementById('gasTab').classList.toggle('active', fuel === 'gas');
        }

        function changeRegion() {
            // Update region display
            document.getElementById('regionDisplay').textContent = currentRegion;
            
            // Get best tariff per supplier for this region
            regionalTariffs = [];
            const seenSuppliers = new Set();
            
            allTariffs
                .filter(t => t.region === currentRegion)
                .sort((a, b) => a.elec_unit_rate_p - b.elec_unit_rate_p)
                .forEach(t => {
                    if (!seenSuppliers.has(t.supplier)) {
                        seenSuppliers.add(t.supplier);
                        regionalTariffs.push(t);
                    }
                });

            populateSuppliers();
            calculateAll();
        }

        function getTariffBadges(tariffName) {
            const badges = [];
            const name = tariffName.toLowerCase();

            // Smart meter required tariffs
            if (name.includes('agile') || name.includes('cosy') ||
                name.includes('intelligent') || name.includes('flux')) {
                badges.push('üì±');
            }

            // EV tariffs
            if (name.includes('go') || name.includes('ev')) {
                badges.push('üöó');
            }

            return badges.length > 0 ? ' ' + badges.join(' ') : '';
        }

        function populateSuppliers() {
            const select = document.getElementById('supplierSelect');
            select.innerHTML = '<option value="">-- Pick a supplier --</option>';
            select.innerHTML += '<option value="svt">‚ö†Ô∏è SVT Price Cap (most expensive default rate)</option>';

            regionalTariffs.forEach((t, i) => {
                const badges = getTariffBadges(t.tariff_name);
                const displayName = supplierNames[t.supplier];
                select.innerHTML += `<option value="${i}">${displayName}${badges}</option>`;
            });

            // Don't auto-select anything, let user choose
            select.value = '';
        }

        function resetToHyphens() {
            document.getElementById('elecRateDisplay').innerHTML = '--<span>p/kWh</span>';
            document.getElementById('gasRateDisplay').innerHTML = '--<span>p/kWh</span>';
            document.getElementById('elecStandingDisplay').innerHTML = '--<span>p/day</span>';
            document.getElementById('gasStandingDisplay').innerHTML = '--<span>p/day</span>';
            document.getElementById('totalBill').innerHTML = '--<span>/mo</span>';
            document.getElementById('billBreakdown').textContent = '--';
            document.getElementById('currentTariffCost').textContent = '--/yr';
            document.getElementById('svtCost').textContent = '--/yr';
            document.getElementById('savingsBadge').textContent = 'Select a supplier to see savings';
            document.getElementById('savingsBadge').style.background = '#94a3b8';

            // Clear chart
            if (tariffChart) {
                tariffChart.destroy();
                tariffChart = null;
            }
        }

        function changeSupplier() {
            const value = document.getElementById('supplierSelect').value;

            if (value === '') {
                // No supplier selected, reset to hyphens
                currentTariff = null;
                resetToHyphens();
                return;
            } else if (value === 'svt') {
                const svt = getSVT();
                currentTariff = {
                    supplier: 'svt',
                    ...svt
                };
            } else {
                currentTariff = regionalTariffs[parseInt(value)];
            }

            updateRatesDisplay();
            calculateAll();
        }

        function updateRatesDisplay() {
            if (!currentTariff) return;

            document.getElementById('elecRateDisplay').innerHTML =
                `${currentTariff.elec_unit_rate_p.toFixed(2)}<span>p/kWh</span>`;
            document.getElementById('elecStandingDisplay').innerHTML =
                `${currentTariff.elec_standing_p.toFixed(1)}<span>p/day</span>`;

            if (currentFuelType === 'dual') {
                document.getElementById('gasRateDisplay').innerHTML =
                    `${(currentTariff.gas_unit_rate_p || 0).toFixed(2)}<span>p/kWh</span>`;
                document.getElementById('gasStandingDisplay').innerHTML =
                    `${(currentTariff.gas_standing_p || 0).toFixed(1)}<span>p/day</span>`;
            }
        }

        function setPeriod(period) {
            currentPeriod = period;
            periodMultiplier = { day: 1, week: 7, month: 30, year: 365 }[period];

            document.querySelectorAll('.period-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            calculateAll();
        }

        function updateAppliance(id) {
            const value = document.getElementById(id).value;
            document.getElementById(`${id}-value`).textContent = parseFloat(value).toFixed(1);
            
            // Recalculate total kWh from all appliances and update inputs
            let totalElecDaily = 0;
            let totalGasDaily = 0;
            
            elecAppliances.forEach(app => {
                const val = parseFloat(document.getElementById(app.id).value);
                if (app.unit.includes('week')) totalElecDaily += (val / 7) * app.power;
                else if (app.unit.includes('mins')) totalElecDaily += (val / 60) * app.power;
                else totalElecDaily += val * app.power;
            });
            
            gasAppliances.forEach(app => {
                const val = parseFloat(document.getElementById(app.id).value);
                if (app.unit.includes('week')) totalGasDaily += (val / 7) * app.power;
                else if (app.unit.includes('mins')) totalGasDaily += (val / 60) * app.power;
                else totalGasDaily += val * app.power;
            });
            
            // Update kWh inputs with annual totals
            document.getElementById('elecKwhInput').value = Math.round(totalElecDaily * 365);
            document.getElementById('gasKwhInput').value = Math.round(totalGasDaily * 365);
            
            calculateAll();
        }

        function calculateAll() {
            if (!currentTariff) {
                // No tariff selected, don't calculate
                return;
            }

            // Get annual kWh from inputs with defaults
            const elecInput = document.getElementById('elecKwhInput');
            const gasInput = document.getElementById('gasKwhInput');
            const elecKwhAnnual = elecInput ? (parseFloat(elecInput.value) || 2900) : 2900;
            const gasKwhAnnual = currentFuelType === 'dual' ? (gasInput ? (parseFloat(gasInput.value) || 12000) : 12000) : 0;

            // Convert to daily for calculations
            const elecKwhDaily = elecKwhAnnual / 365;
            const gasKwhDaily = gasKwhAnnual / 365;

            // Calculate costs for the selected period
            const elecUsageCost = (elecKwhDaily * periodMultiplier * currentTariff.elec_unit_rate_p) / 100;
            const gasUsageCost = currentFuelType === 'dual' ? ((gasKwhDaily * periodMultiplier * (currentTariff.gas_unit_rate_p || 0)) / 100) : 0;
            const elecStandingCost = (currentTariff.elec_standing_p * periodMultiplier) / 100;
            const gasStandingCost = currentFuelType === 'dual' ? ((currentTariff.gas_standing_p || 0) * periodMultiplier / 100) : 0;

            const totalCost = elecUsageCost + gasUsageCost + elecStandingCost + gasStandingCost;

            const periodSuffix = { day: '/day', week: '/wk', month: '/mo', year: '/yr' }[currentPeriod];
            document.getElementById('totalBill').innerHTML = `¬£${totalCost.toFixed(0)}<span>${periodSuffix}</span>`;

            if (currentFuelType === 'dual') {
                document.getElementById('billBreakdown').textContent =
                    `Elec: ¬£${elecUsageCost.toFixed(0)} | Gas: ¬£${gasUsageCost.toFixed(0)} | Standing: ¬£${(elecStandingCost + gasStandingCost).toFixed(0)}`;
            } else {
                document.getElementById('billBreakdown').textContent =
                    `Elec: ¬£${elecUsageCost.toFixed(0)} | Standing: ¬£${elecStandingCost.toFixed(0)}`;
            }

            // Annual comparison
            const annualCurrent = calcAnnualCostFromKwh(currentTariff, elecKwhAnnual, gasKwhAnnual);
            const annualSVT = calcAnnualCostFromKwh(getSVT(), elecKwhAnnual, gasKwhAnnual);

            document.getElementById('currentTariffCost').textContent = `¬£${Math.round(annualCurrent)}/yr`;
            document.getElementById('svtCost').textContent = `¬£${Math.round(annualSVT)}/yr`;

            const savings = annualSVT - annualCurrent;
            const savingsBadge = document.getElementById('savingsBadge');
            if (savings > 0) {
                savingsBadge.textContent = `‚úì You're saving ¬£${Math.round(savings)}/year vs SVT`;
                savingsBadge.style.background = 'var(--sp-green)';
            } else if (savings < 0) {
                savingsBadge.textContent = `‚ö†Ô∏è ¬£${Math.round(Math.abs(savings))}/year more than SVT`;
                savingsBadge.style.background = 'var(--sp-red)';
            } else {
                savingsBadge.textContent = `Same as SVT`;
                savingsBadge.style.background = '#94a3b8';
            }

            // Update appliance costs display (for the fine-tune section)
            updateApplianceCosts();
            
            updateChart(elecKwhAnnual, gasKwhAnnual);
        }
        
        function calcAnnualCostFromKwh(tariff, elecKwhAnnual, gasKwhAnnual) {
            const gasCost = currentFuelType === 'dual' ? (gasKwhAnnual * (tariff.gas_unit_rate_p || 0)) : 0;
            const gasStanding = currentFuelType === 'dual' ? ((tariff.gas_standing_p || 0) * 365) : 0;
            return ((elecKwhAnnual * tariff.elec_unit_rate_p) +
                   gasCost +
                   (tariff.elec_standing_p * 365) +
                   gasStanding) / 100;
        }
        
        function updateApplianceCosts() {
            if (!currentTariff) return;
            
            elecAppliances.forEach(app => {
                const value = parseFloat(document.getElementById(app.id).value);
                let dailyKwh = 0;
                if (app.unit.includes('week')) dailyKwh = (value / 7) * app.power;
                else if (app.unit.includes('mins')) dailyKwh = (value / 60) * app.power;
                else dailyKwh = value * app.power;
                const periodCost = (dailyKwh * periodMultiplier * currentTariff.elec_unit_rate_p) / 100;
                document.getElementById(`${app.id}-cost`).textContent = `¬£${periodCost.toFixed(2)}`;
            });
            
            gasAppliances.forEach(app => {
                const value = parseFloat(document.getElementById(app.id).value);
                let dailyKwh = 0;
                if (app.unit.includes('week')) dailyKwh = (value / 7) * app.power;
                else if (app.unit.includes('mins')) dailyKwh = (value / 60) * app.power;
                else dailyKwh = value * app.power;
                const periodCost = (dailyKwh * periodMultiplier * currentTariff.gas_unit_rate_p) / 100;
                document.getElementById(`${app.id}-cost`).textContent = `¬£${periodCost.toFixed(2)}`;
            });
        }

        function calcAnnualCost(tariff, elecKwhDaily, gasKwhDaily) {
            return ((elecKwhDaily * 365 * tariff.elec_unit_rate_p) + 
                   (gasKwhDaily * 365 * tariff.gas_unit_rate_p) +
                   (tariff.elec_standing_p * 365) +
                   (tariff.gas_standing_p * 365)) / 100;
        }

        function findCheapestIndex() {
            const elecKwhAnnual = parseFloat(document.getElementById('elecKwhInput')?.value) || 2900;
            const gasKwhAnnual = parseFloat(document.getElementById('gasKwhInput')?.value) || 12000;

            let cheapestIdx = 0;
            let lowestCost = Infinity;

            regionalTariffs.forEach((t, i) => {
                const cost = calcAnnualCostFromKwh(t, elecKwhAnnual, gasKwhAnnual);
                if (cost < lowestCost) {
                    lowestCost = cost;
                    cheapestIdx = i;
                }
            });

            return cheapestIdx;
        }

        function updateChart(elecKwhAnnual, gasKwhAnnual) {
            elecKwhAnnual = elecKwhAnnual || parseFloat(document.getElementById('elecKwhInput')?.value) || 2900;
            gasKwhAnnual = gasKwhAnnual || parseFloat(document.getElementById('gasKwhInput')?.value) || 12000;

            const chartData = regionalTariffs.map(t => ({
                supplier: t.supplier,
                name: supplierNames[t.supplier],
                cost: calcAnnualCostFromKwh(t, elecKwhAnnual, gasKwhAnnual),
                tariff: t
            }));

            // Add SVT
            chartData.push({
                supplier: 'svt',
                name: 'SVT Price Cap',
                cost: calcAnnualCostFromKwh(getSVT(), elecKwhAnnual, gasKwhAnnual),
                tariff: null
            });

            chartData.sort((a, b) => a.cost - b.cost);

            const ctx = document.getElementById('tariffChart').getContext('2d');
            
            if (tariffChart) tariffChart.destroy();

            tariffChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: chartData.map(d => d.name),
                    datasets: [{
                        data: chartData.map(d => Math.round(d.cost)),
                        backgroundColor: chartData.map(d => 
                            d.tariff === currentTariff || (d.supplier === 'svt' && currentTariff?.supplier === 'svt')
                                ? supplierColors[d.supplier] 
                                : supplierColors[d.supplier] + '60'
                        ),
                        borderColor: chartData.map(d => 
                            d.tariff === currentTariff || (d.supplier === 'svt' && currentTariff?.supplier === 'svt')
                                ? supplierColors[d.supplier] 
                                : 'transparent'
                        ),
                        borderWidth: 2,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: { label: ctx => `¬£${ctx.raw}/year` }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' },
                            ticks: { callback: v => `¬£${v}` }
                        },
                        y: {
                            grid: { display: false },
                            ticks: { font: { size: 12 } }
                        }
                    },
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const item = chartData[elements[0].index];
                            const select = document.getElementById('supplierSelect');
                            
                            if (item.supplier === 'svt') {
                                select.value = 'svt';
                            } else {
                                const idx = regionalTariffs.indexOf(item.tariff);
                                select.value = idx;
                            }
                            changeSupplier();
                        }
                    }
                }
            });

            tariffChart.chartData = chartData;
        }
    </script>
</body>
</html>
